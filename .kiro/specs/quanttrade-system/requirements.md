# 需求文档

## 介绍

QuantTrade是一个基于Django（后端）和React（前端）构建的多租户量化交易平台，旨在为个人量化交易者、机构投资者和量化策略开发者提供完整的数字货币量化交易解决方案。系统采用Python 3.12 + .venv虚拟环境，支持币安、欧易等主流交易所，提供策略开发、回测、风险控制、实时交易等全套功能。

## 需求

### 需求 1

**用户故事：** 作为系统管理员，我希望能够在后台创建和管理用户账户，配置用户权限，确保每个用户拥有独立的数据空间和安全的访问控制。

#### 验收标准

1. WHEN 管理员访问用户管理后台 THEN 系统 SHALL 显示用户列表和创建用户功能
2. WHEN 管理员创建新用户 THEN 系统 SHALL 生成独立的租户数据空间
3. WHEN 用户登录系统 THEN 系统 SHALL 使用JWT认证机制验证身份
4. WHEN 用户访问数据 THEN 系统 SHALL 确保只能访问自己租户的数据
5. WHEN 管理员分配角色权限 THEN 系统 SHALL 基于RBAC模型控制功能访问

### 需求 2

**用户故事：** 作为交易者，我希望能够在自己的独立空间内管理多个交易所的API连接，配置交易对，并查看各交易所的资产情况。

#### 验收标准

1. WHEN 用户配置交易所API THEN 系统 SHALL 支持币安和欧易交易所连接
2. WHEN 用户测试API连接 THEN 系统 SHALL 验证API密钥有效性并显示连接状态
3. WHEN 用户配置交易对 THEN 系统 SHALL 允许自定义交易对和参数设置
4. WHEN 用户查看资产 THEN 系统 SHALL 实时显示各交易所的资产状况
5. WHEN 用户管理账户状态 THEN 系统 SHALL 支持激活/停用交易账户

### 需求 3

**用户故事：** 作为量化交易者，我希望能够在自己的独立空间内获取和分析实时及历史市场数据，基于自己配置的交易对制定有效的交易策略。

#### 验收标准

1. WHEN 用户访问市场数据 THEN 系统 SHALL 提供实时K线图、深度图、成交记录
2. WHEN 用户查看历史数据 THEN 系统 SHALL 提供历史K线、成交量、价格走势
3. WHEN 用户分析技术指标 THEN 系统 SHALL 支持MA、MACD、RSI、布林带等指标
4. WHEN 用户导出数据 THEN 系统 SHALL 支持CSV、Excel格式导出
5. WHEN 市场数据更新 THEN 系统 SHALL 通过WebSocket实时推送数据

### 需求 4

**用户故事：** 作为策略开发者，我希望能够在自己的独立空间内编写和回测交易策略，管理自己的策略库，以便验证策略的有效性。

#### 验收标准

1. WHEN 用户编写策略 THEN 系统 SHALL 提供Python代码编辑环境，支持语法高亮和自动补全
2. WHEN 用户执行回测 THEN 系统 SHALL 使用历史数据计算策略收益和风险指标
3. WHEN 用户优化参数 THEN 系统 SHALL 支持参数优化和遗传算法
4. WHEN 用户管理策略 THEN 系统 SHALL 提供策略版本控制和策略库管理
5. WHEN 回测完成 THEN 系统 SHALL 生成详细的回测报告和可视化图表

### 需求 5

**用户故事：** 作为交易者，我希望系统能够实时监控我的交易风险并提供预警，在我的独立空间内保护我的资金安全。

#### 验收标准

1. WHEN 系统监控风险 THEN 系统 SHALL 实时计算VaR、最大回撤、夏普比率等风险指标
2. WHEN 风险超过阈值 THEN 系统 SHALL 触发多级风险预警（轻度、中度、重度）
3. WHEN 触发止损条件 THEN 系统 SHALL 自动执行止损止盈机制
4. WHEN 生成风险报告 THEN 系统 SHALL 提供风险分析和可视化报告
5. WHEN 风险预警触发 THEN 系统 SHALL 通过多渠道（系统内、邮件、短信）发送通知

### 需求 6

**用户故事：** 作为交易者，我希望能够在自己的独立空间内通过统一的CCXT框架接口执行各种类型的交易订单，并实现基于自己策略的自动化交易。

#### 验收标准

1. WHEN 用户下单交易 THEN 系统 SHALL 基于CCXT框架支持多交易所统一接口
2. WHEN 用户选择订单类型 THEN 系统 SHALL 支持市价单、限价单、止损单等多种订单
3. WHEN 策略触发交易信号 THEN 系统 SHALL 自动执行交易订单
4. WHEN 交易执行完成 THEN 系统 SHALL 记录完整的交易历史和状态
5. WHEN 订单状态变化 THEN 系统 SHALL 实时同步订单状态和持仓信息

### 需求 7

**用户故事：** 作为系统运维人员，我希望能够通过管理员后台全面监控系统运行状态、管理定时任务和队列，并通过统一的运维终端查看各种系统日志和指标。

#### 验收标准

1. WHEN 运维人员访问监控后台 THEN 系统 SHALL 显示CPU、内存、磁盘、网络等系统资源监控
2. WHEN 管理Celery任务 THEN 系统 SHALL 提供任务监控、队列管理和进程控制
3. WHEN 查看系统日志 THEN 系统 SHALL 提供系统日志、应用日志、访问日志的统一查看
4. WHEN 执行运维操作 THEN 系统 SHALL 提供Web终端进行系统管理和配置修改
5. WHEN 系统异常 THEN 系统 SHALL 自动触发告警并记录详细错误信息

### 需求 8

**用户故事：** 作为系统管理员，我希望通过管理员后台Web界面管理SQLite和MySQL数据库，执行SQL操作，就像使用Navicat一样方便。

#### 验收标准

1. WHEN 管理员连接数据库 THEN 系统 SHALL 支持SQLite和MySQL数据库连接管理
2. WHEN 执行SQL查询 THEN 系统 SHALL 提供SQL编辑器，支持语法高亮和自动补全
3. WHEN 管理表结构 THEN 系统 SHALL 支持表结构查看、修改和索引管理
4. WHEN 导入导出数据 THEN 系统 SHALL 支持CSV、Excel、JSON等多种格式
5. WHEN 查看执行结果 THEN 系统 SHALL 提供结果表格展示，支持排序、过滤、分页

### 需求 9

**用户故事：** 作为系统管理员，我希望通过管理员后台Web界面管理Redis，执行Redis命令，监控Redis状态。

#### 验收标准

1. WHEN 管理员连接Redis THEN 系统 SHALL 支持多Redis实例连接和管理
2. WHEN 执行Redis命令 THEN 系统 SHALL 提供命令执行工具，支持命令自动补全
3. WHEN 浏览Redis数据 THEN 系统 SHALL 支持键值对浏览、编辑和批量操作
4. WHEN 监控Redis性能 THEN 系统 SHALL 显示内存使用、连接数、命令统计等指标
5. WHEN Redis状态异常 THEN 系统 SHALL 提供性能分析和慢查询监控

### 需求 10

**用户故事：** 作为系统管理员，我希望通过管理员后台Web界面管理Celery进程，监控任务执行，查看任务日志。

#### 验收标准

1. WHEN 管理Celery进程 THEN 系统 SHALL 支持worker进程的启动、停止、重启操作
2. WHEN 监控任务执行 THEN 系统 SHALL 显示任务状态、执行时间、成功失败统计
3. WHEN 管理任务队列 THEN 系统 SHALL 支持队列状态查看、清空、暂停恢复操作
4. WHEN 查看任务日志 THEN 系统 SHALL 提供任务执行日志和错误信息查看
5. WHEN 任务异常 THEN 系统 SHALL 支持任务重试、取消和批量操作

### 需求 11

**用户故事：** 作为用户，我希望系统提供现代化的响应式Web界面，支持多设备访问，操作简单直观，并具有完整的UI交互设计。

#### 验收标准

1. WHEN 用户访问登录页面 THEN 系统 SHALL 提供居中卡片式布局，包含用户名密码输入、验证码、记住登录等功能
2. WHEN 用户登录成功 THEN 系统 SHALL 显示主界面导航，包含顶部导航栏、左侧菜单栏、面包屑导航和快速操作区
3. WHEN 用户访问仪表盘 THEN 系统 SHALL 显示统计卡片、图表区域和快速操作，包含总资产、今日盈亏、活跃策略等信息
4. WHEN 用户管理交易所账户 THEN 系统 SHALL 提供左侧账户列表、右侧详情配置和资产监控区域的布局
5. WHEN 用户进行策略管理 THEN 系统 SHALL 提供左侧策略列表、中间代码编辑器、右侧回测配置的三栏布局
6. WHEN 用户执行交易 THEN 系统 SHALL 提供交易对选择、交易面板、订单管理和持仓信息的完整界面
7. WHEN 用户查看市场数据 THEN 系统 SHALL 提供K线图、技术指标、交易对列表和数据导出功能
8. WHEN 用户进行风险控制 THEN 系统 SHALL 提供风险概览、风险指标、风险监控和预警设置的四区域布局
9. WHEN 管理员访问系统管理 THEN 系统 SHALL 提供用户管理、权限配置、系统监控的管理界面
10. WHEN 用户在不同设备访问 THEN 系统 SHALL 支持响应式设计，桌面端(≥1200px)、平板端(768px-1199px)、移动端(<768px)
11. WHEN 用户操作界面 THEN 系统 SHALL 提供加载状态、成功提示、错误提示和确认操作的交互反馈
12. WHEN 数据更新 THEN 系统 SHALL 通过WebSocket实时更新界面数据，支持实时刷新和分页加载

### 需求 12

**用户故事：** 作为系统管理员，我希望能够在后台管理用户角色和权限，为每个用户分配相应的功能权限，确保多租户环境下的系统安全和功能访问控制，同时保证数据隔离。

#### 验收标准

1. WHEN 管理员配置角色 THEN 系统 SHALL 实现RBAC权限模型，支持预定义角色和自定义角色
2. WHEN 分配权限 THEN 系统 SHALL 提供细粒度权限控制和权限继承机制
3. WHEN 管理权限 THEN 系统 SHALL 提供三栏式布局（角色列表 + 权限配置 + 用户分配）
4. WHEN 权限变更 THEN 系统 SHALL 确保数据权限隔离和权限审计功能
5. WHEN 操作权限 THEN 系统 SHALL 支持拖拽分配、权限继承可视化和实时预览

### 需求 13

**用户故事：** 作为系统管理员，我希望能够在后台动态配置系统菜单结构，并根据用户权限显示相应的菜单项，实现菜单的灵活管理。

#### 验收标准

1. WHEN 配置菜单 THEN 系统 SHALL 支持多级菜单结构和拖拽排序
2. WHEN 设置权限 THEN 系统 SHALL 实现基于权限的菜单显示控制
3. WHEN 管理菜单 THEN 系统 SHALL 提供左侧菜单树和右侧配置面板布局
4. WHEN 预览菜单 THEN 系统 SHALL 支持菜单动态加载、缓存和实时预览
5. WHEN 个性化菜单 THEN 系统 SHALL 支持用户自定义菜单布局和图标选择

### 需求 14

**用户故事：** 作为系统管理员，我希望通过管理员后台的统一Web终端界面管理系统，查看各种日志，执行运维操作。

#### 验收标准

1. WHEN 使用Web终端 THEN 系统 SHALL 提供基于Web的SSH终端功能
2. WHEN 管理日志 THEN 系统 SHALL 提供系统日志、应用日志、访问日志的统一管理
3. WHEN 执行运维操作 THEN 系统 SHALL 支持系统重启、服务管理、配置修改
4. WHEN 查看监控 THEN 系统 SHALL 提供实时监控数据展示面板
5. WHEN 操作终端 THEN 系统 SHALL 支持多终端、命令历史、文件传输和快捷键

### 需求 15

**用户故事：** 作为开发运维人员，我希望系统支持Docker容器化部署，便于环境管理和扩展。

#### 验收标准

1. WHEN 部署系统 THEN 系统 SHALL 支持Docker容器化部署和Docker Compose编排
2. WHEN 管理环境 THEN 系统 SHALL 使用Python 3.12 + .venv虚拟环境确保依赖隔离
3. WHEN 扩展系统 THEN 系统 SHALL 支持水平扩展和负载均衡
4. WHEN 备份数据 THEN 系统 SHALL 提供自动化备份和恢复机制
5. WHEN 监控系统 THEN 系统 SHALL 集成监控告警和日志收集

### 需求 16

**用户故事：** 作为用户，我希望系统提供完整的业务闭环设计，确保从策略开发到交易执行的全流程无缝衔接。

#### 验收标准

1. WHEN 策略开发 THEN 系统 SHALL 实现策略开发→回测验证→参数优化→策略部署→实时监控→风险控制→策略调整的完整闭环
2. WHEN 交易执行 THEN 系统 SHALL 实现市场分析→策略信号→风险评估→订单生成→交易所执行→成交确认→持仓更新的交易闭环
3. WHEN 数据流转 THEN 系统 SHALL 实现实时数据流转和历史数据流转的完整闭环
4. WHEN 用户操作 THEN 系统 SHALL 实现操作确认闭环和错误处理闭环
5. WHEN 系统监控 THEN 系统 SHALL 实现性能监控闭环和安全监控闭环

### 需求 17

**用户故事：** 作为用户，我希望系统提供优秀的交互设计和用户体验，确保操作流畅、反馈及时、界面友好。

#### 验收标准

1. WHEN 数据同步 THEN 系统 SHALL 实现WebSocket实时同步、状态同步、冲突解决和一致性检查
2. WHEN 操作反馈 THEN 系统 SHALL 提供操作开始→加载状态→进度显示→操作完成→成功反馈→状态更新的反馈闭环
3. WHEN 异常处理 THEN 系统 SHALL 实现异常发生→错误展示→原因分析→解决建议→自动重试→手动处理的恢复闭环
4. WHEN 模块协作 THEN 系统 SHALL 支持事件驱动、消息队列、API网关和服务发现
5. WHEN 性能优化 THEN 系统 SHALL 实现缓存策略、数据预热、批量处理和异步处理