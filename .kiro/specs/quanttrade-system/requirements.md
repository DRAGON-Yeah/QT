# 需求文档

## 介绍

QuantTrade是一个基于Django（后端）和React（前端）构建的多租户量化交易平台，旨在为个人量化交易者、机构投资者和量化策略开发者提供完整的数字货币量化交易解决方案。系统采用Python 3.12 + .venv虚拟环境，支持币安、欧易等主流交易所，提供策略开发、回测、风险控制、实时交易等全套功能。

系统按照以下菜单结构组织功能模块：
- **仪表盘**：系统概览和快速操作入口
- **账户管理**：用户管理、角色权限、交易账户配置
- **交易中心**：现货交易、订单管理、持仓管理、交易历史
- **策略管理**：策略开发、回测、监控、风险控制
- **数据分析**：市场行情、收益分析、风险分析、报表中心
- **系统设置**：菜单管理、系统监控、数据库管理、日志、配置

## 需求

### 需求 1 - 仪表盘模块

**用户故事：** 作为用户，我希望通过仪表盘快速了解系统整体状况，包括资产概览、交易统计、策略状态和系统通知，以便高效地进行量化交易决策。

#### 验收标准

1. WHEN 用户登录系统 THEN 系统 SHALL 显示个人资产总览，包括总资产、今日盈亏、持仓分布
2. WHEN 用户查看交易统计 THEN 系统 SHALL 显示今日交易次数、成交金额、手续费统计
3. WHEN 用户查看策略状态 THEN 系统 SHALL 显示运行中策略数量、策略收益排行、异常策略告警
4. WHEN 用户查看系统通知 THEN 系统 SHALL 显示风险预警、系统公告、交易提醒等重要信息
5. WHEN 用户需要快速操作 THEN 系统 SHALL 提供快速下单、策略启停、账户切换等快捷入口

### 需求 2 - 账户管理模块

**用户故事：** 作为系统管理员，我希望能够在后台创建和管理用户账户，配置用户权限，管理交易所账户，确保每个用户拥有独立的数据空间和安全的访问控制。

#### 验收标准

1. WHEN 管理员访问用户管理后台 THEN 系统 SHALL 显示用户列表和创建用户功能
2. WHEN 管理员创建新用户 THEN 系统 SHALL 生成独立的租户数据空间
3. WHEN 用户登录系统 THEN 系统 SHALL 使用JWT认证机制验证身份
4. WHEN 用户访问数据 THEN 系统 SHALL 确保只能访问自己租户的数据
5. WHEN 管理员分配角色权限 THEN 系统 SHALL 基于RBAC模型控制功能访问
6. WHEN 用户配置交易所账户 THEN 系统 SHALL 支持币安、欧易等主流交易所API配置
7. WHEN 用户测试交易所连接 THEN 系统 SHALL 验证API密钥有效性并显示连接状态

### 需求 3 - 交易中心模块

**用户故事：** 作为交易者，我希望能够在交易中心进行现货交易，管理订单和持仓，查看交易历史，通过统一的CCXT框架接口执行各种类型的交易订单。

#### 验收标准

1. WHEN 用户进行现货交易 THEN 系统 SHALL 基于CCXT框架支持多交易所统一接口
2. WHEN 用户选择订单类型 THEN 系统 SHALL 支持市价单、限价单、止损单等多种订单
3. WHEN 用户管理订单 THEN 系统 SHALL 提供订单创建、修改、取消、查询功能
4. WHEN 用户查看持仓 THEN 系统 SHALL 实时显示持仓数量、成本价、盈亏状况
5. WHEN 用户查看交易历史 THEN 系统 SHALL 提供完整的交易记录和统计分析
6. WHEN 订单状态变化 THEN 系统 SHALL 实时同步订单状态和持仓信息
7. WHEN 策略触发交易信号 THEN 系统 SHALL 自动执行交易订单

### 需求 4 - 策略管理模块

**用户故事：** 作为策略开发者，我希望能够在策略管理模块编写和回测交易策略，监控策略运行状态，管理风险控制，以便验证和优化策略的有效性。

#### 验收标准

1. WHEN 用户编写策略 THEN 系统 SHALL 提供Python代码编辑环境，支持语法高亮和自动补全
2. WHEN 用户执行回测 THEN 系统 SHALL 使用历史数据计算策略收益和风险指标
3. WHEN 用户优化参数 THEN 系统 SHALL 支持参数优化和遗传算法
4. WHEN 用户管理策略 THEN 系统 SHALL 提供策略版本控制和策略库管理
5. WHEN 回测完成 THEN 系统 SHALL 生成详细的回测报告和可视化图表
6. WHEN 用户监控策略 THEN 系统 SHALL 实时显示策略运行状态、收益情况、风险指标
7. WHEN 系统监控风险 THEN 系统 SHALL 实时计算VaR、最大回撤、夏普比率等风险指标
8. WHEN 风险超过阈值 THEN 系统 SHALL 触发多级风险预警（轻度、中度、重度）
9. WHEN 触发止损条件 THEN 系统 SHALL 自动执行止损止盈机制

### 需求 5 - 数据分析模块

**用户故事：** 作为量化交易者，我希望能够在数据分析模块获取和分析实时及历史市场数据，进行收益和风险分析，生成各类报表，以便制定有效的交易策略。

#### 验收标准

1. WHEN 用户访问市场数据 THEN 系统 SHALL 提供实时K线图、深度图、成交记录
2. WHEN 用户查看历史数据 THEN 系统 SHALL 提供历史K线、成交量、价格走势
3. WHEN 用户分析技术指标 THEN 系统 SHALL 支持MA、MACD、RSI、布林带等指标
4. WHEN 用户导出数据 THEN 系统 SHALL 支持CSV、Excel格式导出
5. WHEN 市场数据更新 THEN 系统 SHALL 通过WebSocket实时推送数据
6. WHEN 用户进行收益分析 THEN 系统 SHALL 提供收益曲线、收益分布、收益统计
7. WHEN 用户进行风险分析 THEN 系统 SHALL 提供风险指标计算、风险分布、相关性分析
8. WHEN 用户生成报表 THEN 系统 SHALL 支持日报、周报、月报等多种报表格式
9. WHEN 风险预警触发 THEN 系统 SHALL 通过多渠道（系统内、邮件、短信）发送通知

### 需求 6 - 系统设置模块

**用户故事：** 作为系统管理员，我希望通过系统设置模块管理菜单结构、监控系统状态、管理数据库和Redis、查看系统日志、配置系统参数。

#### 验收标准

1. WHEN 管理员配置菜单 THEN 系统 SHALL 支持多级菜单结构和拖拽排序
2. WHEN 设置菜单权限 THEN 系统 SHALL 实现基于权限的菜单显示控制
3. WHEN 管理菜单 THEN 系统 SHALL 提供左侧菜单树和右侧配置面板布局
4. WHEN 预览菜单 THEN 系统 SHALL 支持菜单动态加载、缓存和实时预览
5. WHEN 运维人员访问监控后台 THEN 系统 SHALL 显示CPU、内存、磁盘、网络等系统资源监控
6. WHEN 管理Celery任务 THEN 系统 SHALL 提供任务监控、队列管理和进程控制
7. WHEN 系统异常 THEN 系统 SHALL 自动触发告警并记录详细错误信息
8. WHEN 管理员连接数据库 THEN 系统 SHALL 支持SQLite和MySQL数据库连接管理
9. WHEN 执行SQL查询 THEN 系统 SHALL 提供SQL编辑器，支持语法高亮和自动补全
10. WHEN 管理表结构 THEN 系统 SHALL 支持表结构查看、修改和索引管理
11. WHEN 导入导出数据 THEN 系统 SHALL 支持CSV、Excel、JSON等多种格式
12. WHEN 管理员连接Redis THEN 系统 SHALL 支持多Redis实例连接和管理
13. WHEN 执行Redis命令 THEN 系统 SHALL 提供命令执行工具，支持命令自动补全
14. WHEN 浏览Redis数据 THEN 系统 SHALL 支持键值对浏览、编辑和批量操作
15. WHEN 监控Redis性能 THEN 系统 SHALL 显示内存使用、连接数、命令统计等指标
16. WHEN 查看系统日志 THEN 系统 SHALL 提供系统日志、应用日志、访问日志的统一查看
17. WHEN 执行运维操作 THEN 系统 SHALL 提供Web终端进行系统管理和配置修改
18. WHEN 配置系统参数 THEN 系统 SHALL 支持系统配置的在线修改和实时生效

### 需求 7 - 用户界面和交互体验

**用户故事：** 作为用户，我希望系统提供现代化的响应式Web界面，支持多设备访问，操作简单直观，并具有完整的UI交互设计和优秀的用户体验。

#### 验收标准

1. WHEN 用户访问登录页面 THEN 系统 SHALL 提供居中卡片式布局，包含用户名密码输入、验证码、记住登录等功能
2. WHEN 用户登录成功 THEN 系统 SHALL 显示主界面导航，包含顶部导航栏、左侧菜单栏、面包屑导航和快速操作区
3. WHEN 用户访问仪表盘 THEN 系统 SHALL 显示统计卡片、图表区域和快速操作，包含总资产、今日盈亏、活跃策略等信息
4. WHEN 用户管理交易所账户 THEN 系统 SHALL 提供左侧账户列表、右侧详情配置和资产监控区域的布局
5. WHEN 用户进行策略管理 THEN 系统 SHALL 提供左侧策略列表、中间代码编辑器、右侧回测配置的三栏布局
6. WHEN 用户执行交易 THEN 系统 SHALL 提供交易对选择、交易面板、订单管理和持仓信息的完整界面
7. WHEN 用户查看市场数据 THEN 系统 SHALL 提供K线图、技术指标、交易对列表和数据导出功能
8. WHEN 用户进行风险控制 THEN 系统 SHALL 提供风险概览、风险指标、风险监控和预警设置的四区域布局
9. WHEN 管理员访问系统管理 THEN 系统 SHALL 提供用户管理、权限配置、系统监控的管理界面
10. WHEN 用户在不同设备访问 THEN 系统 SHALL 支持响应式设计，桌面端(≥1200px)、平板端(768px-1199px)、移动端(<768px)
11. WHEN 用户操作界面 THEN 系统 SHALL 提供加载状态、成功提示、错误提示和确认操作的交互反馈
12. WHEN 数据更新 THEN 系统 SHALL 通过WebSocket实时更新界面数据，支持实时刷新和分页加载
13. WHEN 数据同步 THEN 系统 SHALL 实现WebSocket实时同步、状态同步、冲突解决和一致性检查
14. WHEN 操作反馈 THEN 系统 SHALL 提供操作开始→加载状态→进度显示→操作完成→成功反馈→状态更新的反馈闭环
15. WHEN 异常处理 THEN 系统 SHALL 实现异常发生→错误展示→原因分析→解决建议→自动重试→手动处理的恢复闭环

### 需求 8 - 系统架构和部署

**用户故事：** 作为开发运维人员，我希望系统支持Docker容器化部署，提供完整的业务闭环设计，确保从策略开发到交易执行的全流程无缝衔接。

#### 验收标准

1. WHEN 部署系统 THEN 系统 SHALL 支持Docker容器化部署和Docker Compose编排
2. WHEN 管理环境 THEN 系统 SHALL 使用Python 3.12 + .venv虚拟环境确保依赖隔离
3. WHEN 扩展系统 THEN 系统 SHALL 支持水平扩展和负载均衡
4. WHEN 备份数据 THEN 系统 SHALL 提供自动化备份和恢复机制
5. WHEN 监控系统 THEN 系统 SHALL 集成监控告警和日志收集
6. WHEN 策略开发 THEN 系统 SHALL 实现策略开发→回测验证→参数优化→策略部署→实时监控→风险控制→策略调整的完整闭环
7. WHEN 交易执行 THEN 系统 SHALL 实现市场分析→策略信号→风险评估→订单生成→交易所执行→成交确认→持仓更新的交易闭环
8. WHEN 数据流转 THEN 系统 SHALL 实现实时数据流转和历史数据流转的完整闭环
9. WHEN 用户操作 THEN 系统 SHALL 实现操作确认闭环和错误处理闭环
10. WHEN 系统监控 THEN 系统 SHALL 实现性能监控闭环和安全监控闭环
11. WHEN 模块协作 THEN 系统 SHALL 支持事件驱动、消息队列、API网关和服务发现
12. WHEN 性能优化 THEN 系统 SHALL 实现缓存策略、数据预热、批量处理和异步处理