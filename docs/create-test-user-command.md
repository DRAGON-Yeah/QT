# åˆ›å»ºæµ‹è¯•ç”¨æˆ·ç®¡ç†å‘½ä»¤æ–‡æ¡£

## å˜åŠ¨æ¦‚è¿°

æ–°å¢äº† `create_test_user` Django ç®¡ç†å‘½ä»¤ï¼Œç”¨äºåœ¨å¼€å‘å’Œæµ‹è¯•ç¯å¢ƒä¸­å¿«é€Ÿåˆ›å»ºæµ‹è¯•ç”¨æˆ·è´¦æˆ·ã€‚è¯¥å‘½ä»¤ç®€åŒ–äº†å¼€å‘è¿‡ç¨‹ä¸­çš„ç”¨æˆ·åˆ›å»ºæµç¨‹ï¼Œæ”¯æŒè‡ªå®šä¹‰ç”¨æˆ·ä¿¡æ¯å’Œç§Ÿæˆ·é…ç½®ã€‚

## æ–°å¢åŠŸèƒ½è¯´æ˜

### 1. ç®¡ç†å‘½ä»¤åˆ›å»º

**æ–‡ä»¶ä½ç½®**: `backend/apps/users/management/commands/create_test_user.py`

åˆ›å»ºäº†ä¸€ä¸ªå®Œæ•´çš„ Django ç®¡ç†å‘½ä»¤ï¼Œæä¾›ä»¥ä¸‹æ ¸å¿ƒåŠŸèƒ½ï¼š

- **è‡ªåŠ¨ç§Ÿæˆ·åˆ›å»º**: å¦‚æœæŒ‡å®šçš„ç§Ÿæˆ·ä¸å­˜åœ¨ï¼Œè‡ªåŠ¨åˆ›å»ºæ–°ç§Ÿæˆ·
- **ç”¨æˆ·è´¦æˆ·åˆ›å»º**: åˆ›å»ºå…·æœ‰ç®¡ç†å‘˜æƒé™çš„æµ‹è¯•ç”¨æˆ·
- **å‚æ•°åŒ–é…ç½®**: æ”¯æŒé€šè¿‡å‘½ä»¤è¡Œå‚æ•°è‡ªå®šä¹‰ç”¨æˆ·ä¿¡æ¯
- **é‡å¤æ£€æŸ¥**: é˜²æ­¢åˆ›å»ºé‡å¤çš„ç”¨æˆ·è´¦æˆ·
- **å‹å¥½è¾“å‡º**: æä¾›æ¸…æ™°çš„ä¸­æ–‡çŠ¶æ€åé¦ˆ

### 2. å‘½ä»¤å‚æ•°æ”¯æŒ

æ”¯æŒä»¥ä¸‹å¯é€‰å‚æ•°ï¼š

| å‚æ•° | é»˜è®¤å€¼ | è¯´æ˜ |
|------|--------|------|
| `--username` | `admin` | ç”¨æˆ·å |
| `--password` | `admin123` | ç™»å½•å¯†ç  |
| `--email` | `admin@quanttrade.com` | é‚®ç®±åœ°å€ |
| `--tenant-name` | `æµ‹è¯•ç§Ÿæˆ·` | ç§Ÿæˆ·åç§° |

### 3. ç”¨æˆ·æƒé™é…ç½®

åˆ›å»ºçš„æµ‹è¯•ç”¨æˆ·å…·æœ‰ä»¥ä¸‹æƒé™ï¼š

- **è¶…çº§ç”¨æˆ·æƒé™** (`is_superuser=True`)
- **ç®¡ç†å‘˜æƒé™** (`is_staff=True`)
- **ç§Ÿæˆ·ç®¡ç†å‘˜æƒé™** (`is_tenant_admin=True`)
- **æ¿€æ´»çŠ¶æ€** (`is_active=True`)

## ä»£ç ç»“æ„è¯´æ˜

### ç±»ç»“æ„

```python
class Command(BaseCommand):
    """Django ç®¡ç†å‘½ä»¤ç±»"""
    
    def add_arguments(self, parser):
        """æ·»åŠ å‘½ä»¤è¡Œå‚æ•°"""
        
    def handle(self, *args, **options):
        """æ‰§è¡Œå‘½ä»¤çš„ä¸»è¦é€»è¾‘"""
```

### æ ¸å¿ƒé€»è¾‘æµç¨‹

1. **å‚æ•°è§£æ**: ä»å‘½ä»¤è¡Œè·å–ç”¨æˆ·é…ç½®å‚æ•°
2. **ç§Ÿæˆ·å¤„ç†**: åˆ›å»ºæˆ–è·å–æŒ‡å®šçš„ç§Ÿæˆ·
3. **ç”¨æˆ·éªŒè¯**: æ£€æŸ¥ç”¨æˆ·æ˜¯å¦å·²å­˜åœ¨ï¼Œé¿å…é‡å¤åˆ›å»º
4. **ç”¨æˆ·åˆ›å»º**: åˆ›å»ºå…·æœ‰å®Œæ•´æƒé™çš„æµ‹è¯•ç”¨æˆ·
5. **ç»“æœåé¦ˆ**: è¾“å‡ºåˆ›å»ºç»“æœå’Œç™»å½•ä¿¡æ¯

### é”™è¯¯å¤„ç†

- ä½¿ç”¨ try-catch å—æ•è·å¼‚å¸¸
- æä¾›å‹å¥½çš„ä¸­æ–‡é”™è¯¯ä¿¡æ¯
- ä½¿ç”¨ Django çš„æ ·å¼åŒ–è¾“å‡ºï¼ˆSUCCESSã€WARNINGã€ERRORï¼‰

## ä½¿ç”¨ç¤ºä¾‹

### 1. ä½¿ç”¨é»˜è®¤å‚æ•°åˆ›å»ºç”¨æˆ·

```bash
# åˆ›å»ºé»˜è®¤çš„ç®¡ç†å‘˜ç”¨æˆ·
python manage.py create_test_user

# è¾“å‡ºç¤ºä¾‹ï¼š
# âœ… åˆ›å»ºç§Ÿæˆ·: æµ‹è¯•ç§Ÿæˆ·
# âœ… åˆ›å»ºç”¨æˆ·æˆåŠŸ!
#    ç”¨æˆ·å: admin
#    å¯†ç : admin123
#    é‚®ç®±: admin@quanttrade.com
#    ç§Ÿæˆ·: æµ‹è¯•ç§Ÿæˆ·
# ğŸ‰ ç°åœ¨å¯ä»¥ä½¿ç”¨è¿™ä¸ªè´¦æˆ·ç™»å½•ç³»ç»Ÿäº†!
```

### 2. è‡ªå®šä¹‰ç”¨æˆ·ä¿¡æ¯

```bash
# åˆ›å»ºè‡ªå®šä¹‰ç”¨æˆ·
python manage.py create_test_user \
    --username=testuser \
    --password=mypassword123 \
    --email=test@example.com \
    --tenant-name="å¼€å‘æµ‹è¯•ç§Ÿæˆ·"
```

### 3. åœ¨ Docker ç¯å¢ƒä¸­ä½¿ç”¨

```bash
# åœ¨ Docker å®¹å™¨ä¸­æ‰§è¡Œ
docker-compose exec backend python manage.py create_test_user

# æˆ–è€…åœ¨å®¹å™¨å¯åŠ¨æ—¶è‡ªåŠ¨åˆ›å»º
docker-compose exec backend python manage.py create_test_user --username=demo --password=demo123
```

### 4. å¼€å‘ç¯å¢ƒåˆå§‹åŒ–è„šæœ¬

```bash
#!/bin/bash
# init-dev-users.sh - å¼€å‘ç¯å¢ƒç”¨æˆ·åˆå§‹åŒ–è„šæœ¬

echo "åˆå§‹åŒ–å¼€å‘ç¯å¢ƒç”¨æˆ·..."

# åˆ›å»ºç®¡ç†å‘˜ç”¨æˆ·
python manage.py create_test_user \
    --username=admin \
    --password=admin123 \
    --email=admin@quanttrade.local \
    --tenant-name="å¼€å‘ç§Ÿæˆ·"

# åˆ›å»ºæµ‹è¯•äº¤æ˜“å‘˜
python manage.py create_test_user \
    --username=trader \
    --password=trader123 \
    --email=trader@quanttrade.local \
    --tenant-name="äº¤æ˜“æµ‹è¯•ç§Ÿæˆ·"

echo "ç”¨æˆ·åˆå§‹åŒ–å®Œæˆï¼"
```

## é›†æˆåˆ°é¡¹ç›®å·¥ä½œæµ

### 1. Docker Compose é›†æˆ

åœ¨ `docker-compose.yml` ä¸­æ·»åŠ åˆå§‹åŒ–æ­¥éª¤ï¼š

```yaml
services:
  backend:
    # ... å…¶ä»–é…ç½®
    command: >
      sh -c "python manage.py migrate &&
             python manage.py create_test_user &&
             python manage.py runserver 0.0.0.0:8000"
```

### 2. Makefile é›†æˆ

åœ¨é¡¹ç›® `Makefile` ä¸­æ·»åŠ ä¾¿æ·å‘½ä»¤ï¼š

```makefile
# åˆ›å»ºæµ‹è¯•ç”¨æˆ·
create-test-user:
	docker-compose exec backend python manage.py create_test_user

# åˆ›å»ºè‡ªå®šä¹‰æµ‹è¯•ç”¨æˆ·
create-user:
	@read -p "ç”¨æˆ·å: " username; \
	read -p "å¯†ç : " password; \
	read -p "é‚®ç®±: " email; \
	docker-compose exec backend python manage.py create_test_user \
		--username=$$username --password=$$password --email=$$email
```

### 3. å¼€å‘ç¯å¢ƒè‡ªåŠ¨åŒ–

åœ¨é¡¹ç›®åˆå§‹åŒ–è„šæœ¬ä¸­é›†æˆï¼š

```bash
# scripts/setup-dev.sh
#!/bin/bash

echo "è®¾ç½®å¼€å‘ç¯å¢ƒ..."

# å¯åŠ¨æœåŠ¡
docker-compose up -d

# ç­‰å¾…æ•°æ®åº“å°±ç»ª
sleep 10

# æ‰§è¡Œè¿ç§»
docker-compose exec backend python manage.py migrate

# åˆ›å»ºæµ‹è¯•ç”¨æˆ·
docker-compose exec backend python manage.py create_test_user

echo "å¼€å‘ç¯å¢ƒè®¾ç½®å®Œæˆï¼"
echo "ç™»å½•ä¿¡æ¯ï¼š"
echo "  ç”¨æˆ·å: admin"
echo "  å¯†ç : admin123"
echo "  è®¿é—®åœ°å€: http://localhost:3000"
```

## æ³¨æ„äº‹é¡¹

### 1. å®‰å…¨è€ƒè™‘

- **ä»…ç”¨äºå¼€å‘/æµ‹è¯•**: æ­¤å‘½ä»¤ä»…åº”åœ¨å¼€å‘å’Œæµ‹è¯•ç¯å¢ƒä¸­ä½¿ç”¨
- **å¯†ç å®‰å…¨**: é»˜è®¤å¯†ç è¾ƒå¼±ï¼Œç”Ÿäº§ç¯å¢ƒåº”ä½¿ç”¨å¼ºå¯†ç 
- **æƒé™æ§åˆ¶**: åˆ›å»ºçš„ç”¨æˆ·å…·æœ‰æœ€é«˜æƒé™ï¼Œéœ€è°¨æ…ä½¿ç”¨

### 2. ç¯å¢ƒé™åˆ¶

- **å¼€å‘ç¯å¢ƒ**: ä¸»è¦ç”¨äºæœ¬åœ°å¼€å‘ç¯å¢ƒçš„å¿«é€Ÿç”¨æˆ·åˆ›å»º
- **æµ‹è¯•ç¯å¢ƒ**: å¯ç”¨äºè‡ªåŠ¨åŒ–æµ‹è¯•çš„ç”¨æˆ·æ•°æ®å‡†å¤‡
- **ç”Ÿäº§ç¯å¢ƒ**: ä¸å»ºè®®åœ¨ç”Ÿäº§ç¯å¢ƒä½¿ç”¨æ­¤å‘½ä»¤

### 3. æ•°æ®ä¸€è‡´æ€§

- **ç§Ÿæˆ·åˆ›å»º**: å¦‚æœç§Ÿæˆ·ä¸å­˜åœ¨ä¼šè‡ªåŠ¨åˆ›å»ºï¼Œç¡®ä¿æ•°æ®ä¸€è‡´æ€§
- **é‡å¤æ£€æŸ¥**: é˜²æ­¢åˆ›å»ºé‡å¤ç”¨æˆ·ï¼Œé¿å…æ•°æ®å†²çª
- **äº‹åŠ¡å®‰å…¨**: ä½¿ç”¨ Django ORM ç¡®ä¿æ•°æ®åº“æ“ä½œçš„äº‹åŠ¡å®‰å…¨

### 4. æ‰©å±•å»ºè®®

#### æ·»åŠ è§’è‰²åˆ†é…åŠŸèƒ½

```python
# åœ¨ handle æ–¹æ³•ä¸­æ·»åŠ è§’è‰²åˆ†é…é€»è¾‘
def handle(self, *args, **options):
    # ... ç°æœ‰ä»£ç 
    
    # åˆ†é…é»˜è®¤è§’è‰²
    try:
        admin_role = Role.objects.get(name='è¶…çº§ç®¡ç†å‘˜', tenant=tenant)
        user.roles.add(admin_role)
        self.stdout.write(f'   è§’è‰²: {admin_role.name}')
    except Role.DoesNotExist:
        self.stdout.write(
            self.style.WARNING('âš ï¸ æœªæ‰¾åˆ°é»˜è®¤è§’è‰²ï¼Œè¯·æ‰‹åŠ¨åˆ†é…')
        )
```

#### æ·»åŠ æ‰¹é‡åˆ›å»ºåŠŸèƒ½

```python
def add_arguments(self, parser):
    # ... ç°æœ‰å‚æ•°
    parser.add_argument(
        '--count',
        type=int,
        default=1,
        help='åˆ›å»ºç”¨æˆ·æ•°é‡ (é»˜è®¤: 1)'
    )
```

#### æ·»åŠ é…ç½®æ–‡ä»¶æ”¯æŒ

```python
def add_arguments(self, parser):
    # ... ç°æœ‰å‚æ•°
    parser.add_argument(
        '--config-file',
        type=str,
        help='ä»é…ç½®æ–‡ä»¶è¯»å–ç”¨æˆ·ä¿¡æ¯'
    )
```

## ç›¸å…³æ–‡ä»¶

- **ç”¨æˆ·æ¨¡å‹**: `backend/apps/users/models.py`
- **ç§Ÿæˆ·æ¨¡å‹**: `backend/apps/core/models.py`
- **ç”¨æˆ·æœåŠ¡**: `backend/apps/users/services.py`
- **é¡¹ç›®é…ç½®**: `backend/config/settings/`

## åç»­ä¼˜åŒ–å»ºè®®

1. **æ·»åŠ ç”¨æˆ·é…ç½®æ¨¡æ¿**: æ”¯æŒä» JSON/YAML æ–‡ä»¶æ‰¹é‡åˆ›å»ºç”¨æˆ·
2. **é›†æˆæƒé™åˆ†é…**: è‡ªåŠ¨åˆ†é…é€‚å½“çš„è§’è‰²å’Œæƒé™
3. **æ·»åŠ éªŒè¯é€»è¾‘**: å¢å¼ºé‚®ç®±æ ¼å¼ã€å¯†ç å¼ºåº¦éªŒè¯
4. **æ”¯æŒç¯å¢ƒå˜é‡**: å…è®¸é€šè¿‡ç¯å¢ƒå˜é‡é…ç½®é»˜è®¤å€¼
5. **æ·»åŠ æ¸…ç†å‘½ä»¤**: æä¾›åˆ é™¤æµ‹è¯•ç”¨æˆ·çš„åå‘æ“ä½œ

è¿™ä¸ªç®¡ç†å‘½ä»¤å¤§å¤§ç®€åŒ–äº†å¼€å‘å’Œæµ‹è¯•ç¯å¢ƒä¸­çš„ç”¨æˆ·ç®¡ç†æµç¨‹ï¼Œæé«˜äº†å¼€å‘æ•ˆç‡ï¼Œæ˜¯ QuantTrade é¡¹ç›®å¼€å‘å·¥å…·é“¾çš„é‡è¦è¡¥å……ã€‚